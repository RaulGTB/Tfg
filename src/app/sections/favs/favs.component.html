<section class="section-favorites py-5 bg-black text-white border-top border-secondary fade-up">

  <div class="strip-container d-none d-xl-block">
    <img src="assets/images/vertical-background.jpg" class="side-fill-img side-left d-none d-xl-block"
      alt="Decoración izquierda" />
    <img src="assets/images/vertical-background.jpg" class="side-fill-img side-right d-none d-xl-block"
      alt="Decoración derecha" />
  </div>

  <div class="container">

    <div class="d-flex justify-content-between align-items-center mb-4 fade-up">
      <h4 class="text-light mb-0">
        <i class="bi bi-bookmark-check-fill me-2 text-warning"></i>Gestionar favoritos
      </h4>

    </div>

    <!-- Título -->
    <h2 class="section-title mb-5 text-center text-lime pop-in">
      <i class="bi bi-star-fill me-2 text-warning"></i>Mis favoritos
    </h2>

    <div *ngIf="successMsg" class="alert alert-success fade-up">{{ successMsg }}</div>
    <div *ngIf="errorMsg" class="alert alert-danger fade-up">{{ errorMsg }}</div>

    <button class="btn btn-danger mb-4" (click)="deleteAllFavorites()">
      <i class="bi bi-trash-fill me-1"></i>Eliminar todos
    </button>

    <!-- Grupo por tipo -->
    <div *ngFor="let type of objectKeys(groupedFavorites)" class="mb-5 fade-up">
      <h4 class="text-capitalize text-lime mb-4 border-bottom border-lime pb-2">
        <i class="bi bi-bookmark-fill me-2 text-warning"></i>{{ type }}
      </h4>

      <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
        <div *ngFor="let fav of groupedFavorites[type]" class="col">
          <div
            class="bg-dark border border-secondary rounded-4 p-4 h-100 shadow-sm position-relative hover-glow fade-up">

            <!-- Header: Imagen + Nombre -->
            <div class="d-flex align-items-center mb-3">
              <img *ngIf="fav.itemData?.image_url" [src]="fav.itemData.image_url" alt="imagen"
                class="me-3 rounded-circle border border-light" width="50" height="50" />
              <h5 class="mb-0 text-light">{{ fav.itemData?.name || ('ID ' + fav.itemId) }}</h5>
            </div>

            <!-- Contenido dinámico según tipo -->
            <div class="mb-3">
              <ng-container [ngSwitch]="fav.itemType">

                <!-- Jugador -->
                <ng-container *ngSwitchCase="'player'">
                  <p *ngIf="fav.itemData?.first_name"><strong>Nombre real:</strong> {{ fav.itemData.first_name }}</p>
                  <p *ngIf="fav.itemData?.current_videogame?.name"><strong>Juego:</strong> {{
                    fav.itemData.current_videogame.name }}</p>
                </ng-container>

                <!-- Equipo -->
                <ng-container *ngSwitchCase="'team'">
                  <p><strong>Acrónimo:</strong> {{ fav.itemData?.acronym || 'N/A' }}</p>
                  <p><strong>Juego:</strong> {{ fav.itemData?.current_videogame?.name || 'N/A' }}</p>
                </ng-container>

                <ng-container *ngSwitchCase="'csgo_team'">
                  <p><strong>Acrónimo:</strong> {{ fav.itemData?.acronym || 'N/A' }}</p>
                  <p><strong>Juego:</strong> {{ fav.itemData?.current_videogame?.name || 'N/A' }}</p>
                </ng-container>

                <!-- Liga / Torneo -->
                <ng-container *ngSwitchCase="'league'">
                  <p><strong>Serie:</strong> {{ fav.itemData?.serie?.full_name || 'Sin serie' }}</p>
                  <p><strong>Juego:</strong> {{ fav.itemData?.videogame?.name || 'N/A' }}</p>
                </ng-container>

                <ng-container *ngSwitchCase="'tournament'">
                  <p><strong>Serie:</strong> {{ fav.itemData?.serie?.full_name || 'Sin serie' }}</p>
                  <p><strong>Juego:</strong> {{ fav.itemData?.videogame?.name || 'N/A' }}</p>
                </ng-container>

                <ng-container *ngSwitchCase="'csgo_tournament'">
                  <p><strong>Serie:</strong> {{ fav.itemData?.serie?.full_name || 'Sin serie' }}</p>
                  <p><strong>Juego:</strong> {{ fav.itemData?.videogame?.name || 'N/A' }}</p>
                </ng-container>

                <!-- Partidos -->
                <ng-container *ngSwitchCase="'match'">
                  <p><strong>Fecha:</strong> {{ fav.itemData?.begin_at ? (fav.itemData.begin_at | date:'short') : 'Por
                    definir' }}</p>
                  <p><strong>Equipos:</strong> {{ getOpponentsNames(fav.itemData?.opponents) }}</p>
                </ng-container>

                <ng-container *ngSwitchCase="'csgo_match'">
                  <p><strong>Fecha:</strong> {{ fav.itemData?.begin_at ? (fav.itemData.begin_at | date:'short') : 'Por
                    definir' }}</p>
                  <p><strong>Equipos:</strong> {{ getOpponentsNames(fav.itemData?.opponents) }}</p>
                </ng-container>

              </ng-container>
            </div>

            <!-- Tipo + Botón -->
            <div class="d-flex justify-content-between align-items-center">
              <span class="text-muted small">
                <i class="bi bi-tag-fill me-1 text-warning"></i>{{ fav.itemType }}
              </span>

              <button class="btn btn-sm btn-danger" (click)="removeFavorite(fav.id)">
                <i class="bi bi-trash-fill me-1"></i>Eliminar
              </button>

            </div>

          </div>
        </div>
      </div>
    </div>

  </div>
</section>
